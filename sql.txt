CREATE TABLE IF NOT EXISTS users (
  id              INTEGER PRIMARY KEY AUTOINCREMENT, -- 建议 UUID
  email           TEXT,                          -- 可选：邮箱登录
  username        TEXT,                          -- 可选：用户名
  password_hash   TEXT,                          -- 若支持密码登录
  role            TEXT NOT NULL DEFAULT 'user',   -- user/admin 等
  status          INTEGER NOT NULL DEFAULT 0,     -- 0=正常 1=禁用
  deleted_at      INTEGER,                         -- 软删除时间；NULL=未删除
  created_at      INTEGER NOT NULL,              -- unix seconds
  updated_at      INTEGER
);

CREATE UNIQUE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE UNIQUE INDEX IF NOT EXISTS idx_users_username ON users(username);
CREATE INDEX IF NOT EXISTS idx_users_status ON users(status);
CREATE TABLE IF NOT EXISTS api_tokens (
  id              INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  user_id         INTEGER NOT NULL,             -- 不建外键
  name            TEXT,                        -- 便于用户区分用途
  token_hash      TEXT NOT NULL,               -- 仅存 hash
  scopes          TEXT,                        -- JSON/CSV：如 "links:rw,stats:r"
  status          INTEGER NOT NULL DEFAULT 0,   -- 0=启用 1=禁用
  last_used_at    INTEGER,                     -- unix seconds
  expires_at      INTEGER,                     -- unix seconds, NULL=永不过期
  created_at      INTEGER NOT NULL
);

CREATE UNIQUE INDEX IF NOT EXISTS idx_api_tokens_token_hash ON api_tokens(token_hash);
CREATE INDEX IF NOT EXISTS idx_api_tokens_user_id ON api_tokens(user_id);
CREATE INDEX IF NOT EXISTS idx_api_tokens_status ON api_tokens(status);
CREATE INDEX IF NOT EXISTS idx_api_tokens_expires_at ON api_tokens(expires_at);
CREATE TABLE IF NOT EXISTS domains (
  id              INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  host            TEXT NOT NULL,                 -- 如 "s.example.com"
  is_active       INTEGER NOT NULL DEFAULT 0,    -- 0=启用 1=停用
  is_default      INTEGER NOT NULL DEFAULT 0,    -- 1=默认域名
  notes           TEXT,
  
  -- 域名级别的模板设置（NULL 则使用系统默认）
  error_template_id       INTEGER,               -- 错误页模板 redirect_templates.id
  password_template_id    INTEGER,               -- 密码验证页模板 redirect_templates.id
  interstitial_template_id INTEGER,              -- 中间页模板 redirect_templates.id
  
  created_at      INTEGER NOT NULL,
  updated_at      INTEGER
);

CREATE UNIQUE INDEX IF NOT EXISTS idx_domains_host ON domains(host);
CREATE INDEX IF NOT EXISTS idx_domains_active ON domains(is_active);
CREATE INDEX IF NOT EXISTS idx_domains_default ON domains(is_default);
CREATE INDEX IF NOT EXISTS idx_domains_error_tpl ON domains(error_template_id);
CREATE INDEX IF NOT EXISTS idx_domains_password_tpl ON domains(password_template_id);
CREATE INDEX IF NOT EXISTS idx_domains_interstitial_tpl ON domains(interstitial_template_id);
CREATE TABLE IF NOT EXISTS redirect_templates (
  id              INTEGER PRIMARY KEY AUTOINCREMENT,
  name            TEXT NOT NULL,                     -- 模板名
  
  -- 内容来源设置
  content_type    INTEGER NOT NULL DEFAULT 0,        -- 0=HTML content, 1=文件
  html_content    TEXT,                              -- 完整 HTML（content_type=0 时使用）
  main_file       TEXT,                              -- 主文件路径（content_type=1 时使用，如 "/index.html"，指向 template_assets 中的文件名）
  
  asset_prefix    TEXT,                              -- 资源路径前缀（随机字符串，如 "a3f8x9k2"），用于隔离和防枚举
  is_active       INTEGER NOT NULL DEFAULT 1,        -- 1启用，0禁用
  type            INTEGER,                           -- 0普通模板，1要求密码，2错误页，3未找到短连接
  created_by      INTEGER,                           -- user_id（不建外键）
  created_at      INTEGER NOT NULL,
  updated_at      INTEGER
);

CREATE INDEX IF NOT EXISTS idx_redirect_templates_active ON redirect_templates(is_active);
CREATE INDEX IF NOT EXISTS idx_redirect_templates_created_by ON redirect_templates(created_by);
-- 改为普通索引，允许多个模板共享同一个 asset_prefix
CREATE INDEX IF NOT EXISTS idx_redirect_templates_asset_prefix ON redirect_templates(asset_prefix);
CREATE INDEX IF NOT EXISTS idx_redirect_templates_content_type ON redirect_templates(content_type);
CREATE TABLE IF NOT EXISTS short_links (
  id                 INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  domain_id          INTEGER NOT NULL,                  -- domains.id（无外键）
  code               TEXT NOT NULL,                     -- 短码（可自定义）
  target_url         TEXT NOT NULL,                     -- 目标地址（可编辑）
  owner_user_id      INTEGER NOT NULL,                  -- users.id（无外键）

  redirect_http_code INTEGER NOT NULL DEFAULT 302,      -- 301/302/307/308 等
  use_interstitial   INTEGER NOT NULL DEFAULT 0,        -- 是否中转页
  interstitial_delay INTEGER NOT NULL DEFAULT 0,        -- 中转页等待时间（秒），0为不等待
  force_interstitial INTEGER NOT NULL DEFAULT 0,        -- 是否强制中转页验签：0=不强制，1=强制
  template_id        INTEGER,                           -- 中间页模板 redirect_templates.id（无外键）

  -- 短链接级别的模板设置（NULL 则继承域名设置，域名也为 NULL 则使用系统默认）
  error_template_id    INTEGER,                         -- 错误页模板 redirect_templates.id
  password_template_id INTEGER,                         -- 密码验证页模板 redirect_templates.id

  password          TEXT,                             -- 若启用密码访问则存，这里存储明文
  max_visits        INTEGER,                          -- 访问次数限制；NULL=无限
  expire_at         INTEGER,                          -- 过期时间；NULL=不过期

  is_disabled       INTEGER NOT NULL DEFAULT 0,        -- 禁用（逻辑）
  deleted_at        INTEGER,                          -- 软删除时间；NULL=未删除

  remark            TEXT,                             -- 备注

  created_at        INTEGER NOT NULL,
  updated_at        INTEGER,

  -- 冗余统计（快速查询用；详细统计在事件表）
  total_clicks      INTEGER NOT NULL DEFAULT 0,
  last_access_at    INTEGER
);

-- 同一域名下短码唯一（支持自定义短码）
CREATE UNIQUE INDEX IF NOT EXISTS idx_short_links_domain_code
  ON short_links(domain_id, code);

CREATE INDEX IF NOT EXISTS idx_short_links_owner ON short_links(owner_user_id);
CREATE INDEX IF NOT EXISTS idx_short_links_deleted ON short_links(deleted_at);
CREATE INDEX IF NOT EXISTS idx_short_links_disabled ON short_links(is_disabled);
CREATE INDEX IF NOT EXISTS idx_short_links_expire_at ON short_links(expire_at);
CREATE INDEX IF NOT EXISTS idx_short_links_template ON short_links(template_id);
CREATE INDEX IF NOT EXISTS idx_short_links_error_tpl ON short_links(error_template_id);
CREATE INDEX IF NOT EXISTS idx_short_links_password_tpl ON short_links(password_template_id);
CREATE INDEX IF NOT EXISTS idx_short_links_last_access ON short_links(last_access_at);
CREATE INDEX IF NOT EXISTS idx_short_links_force_interstitial ON short_links(force_interstitial);
CREATE TABLE IF NOT EXISTS tags (
  id            INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  name          TEXT NOT NULL,                     -- 标签名（全局唯一）
  created_at    INTEGER NOT NULL
);

CREATE UNIQUE INDEX IF NOT EXISTS idx_tags_name ON tags(name);
CREATE TABLE IF NOT EXISTS short_link_tags (
  id            INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  short_link_id INTEGER NOT NULL,                  -- short_links.id（无外键）
  tag_id        INTEGER NOT NULL,                  -- tags.id（无外键）
  created_at    INTEGER NOT NULL
);

-- 防止重复打同一个标签
CREATE UNIQUE INDEX IF NOT EXISTS idx_slt_unique
  ON short_link_tags(short_link_id, tag_id);

CREATE INDEX IF NOT EXISTS idx_slt_short_link ON short_link_tags(short_link_id);
CREATE INDEX IF NOT EXISTS idx_slt_tag ON short_link_tags(tag_id);
CREATE TABLE IF NOT EXISTS link_visit_events (
  id              INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  short_link_id   INTEGER NOT NULL,                  -- short_links.id（无外键）
  domain_id       INTEGER NOT NULL,                  -- domains.id（无外键，便于按域过滤）
  code            TEXT NOT NULL,                     -- 冗余保存，便于排查/归档
  visited_at      INTEGER NOT NULL,          -- unix seconds

  -- 访问上下文（按需增删）
  ip              TEXT,                      -- IP地址
  ua              TEXT,                      -- user-agent
  referer         TEXT,
  country         TEXT,                      -- e.g. "CN"
  region          TEXT,
  city            TEXT,
  device_type     TEXT,                      -- mobile/desktop/bot/...
  os              TEXT,
  browser         TEXT,

  -- 访问结果
  is_blocked      INTEGER NOT NULL DEFAULT 0, -- 因禁用/过期/次数限制/密码失败等
  block_reason    TEXT,                       -- disabled/deleted/expired/limit/password/...
  http_status     INTEGER                     -- 实际返回状态码
);

CREATE INDEX IF NOT EXISTS idx_lve_link_time ON link_visit_events(short_link_id, visited_at);
CREATE INDEX IF NOT EXISTS idx_lve_time ON link_visit_events(visited_at);
CREATE INDEX IF NOT EXISTS idx_lve_domain_code_time ON link_visit_events(domain_id, code, visited_at);
CREATE INDEX IF NOT EXISTS idx_lve_country ON link_visit_events(country);
CREATE INDEX IF NOT EXISTS idx_lve_blocked ON link_visit_events(is_blocked);
CREATE TABLE IF NOT EXISTS link_visit_stats_daily (
  id              INTEGER PRIMARY KEY AUTOINCREMENT, -- UUID
  short_link_id   INTEGER NOT NULL,                  -- short_links.id（无外键）
  day             TEXT NOT NULL,             -- "YYYY-MM-DD"
  clicks          INTEGER NOT NULL DEFAULT 0,
  blocked         INTEGER NOT NULL DEFAULT 0,
  unique_ips      INTEGER NOT NULL DEFAULT 0, -- 若你在应用层做去重统计
  unique_users    INTEGER NOT NULL DEFAULT 0  -- 可选：若有登录态/指纹
);

CREATE UNIQUE INDEX IF NOT EXISTS idx_lvsd_unique ON link_visit_stats_daily(short_link_id, day);
CREATE INDEX IF NOT EXISTS idx_lvsd_day ON link_visit_stats_daily(day);
CREATE TABLE IF NOT EXISTS app_settings (
  key         TEXT PRIMARY KEY,
  value       TEXT NOT NULL,
  updated_at  INTEGER
);

CREATE TABLE IF NOT EXISTS template_assets (
  id              INTEGER PRIMARY KEY AUTOINCREMENT,
  asset_prefix    TEXT NOT NULL,                     -- 资源路径前缀（随机字符串，如 "a3f8x9k2"），用于隔离和防枚举
  -- 文件信息
  filename        TEXT NOT NULL,                     -- 原始文件名，如 "logo.png"
  content_type    TEXT,                              -- MIME 类型，如 "image/png"
  size            INTEGER,                           -- 文件大小（字节）
  checksum        TEXT,                              -- 文件哈希（用于去重/校验）

  -- 存储方式（二选一）
  storage_type    INTEGER NOT NULL DEFAULT 0,        -- 0=数据库存储, 1=R2存储
  content         BLOB,                              -- 文件内容（storage_type=0 时使用）
  r2_key          TEXT,                              -- R2 对象键（storage_type=1 时使用）

  -- 访问控制
  is_public       INTEGER NOT NULL DEFAULT 0,        -- 1=允许通过 asset 路径访问, 0=不允许

  -- 元数据
  alt_text        TEXT,                              -- 可选：图片 alt 文本

  created_at      INTEGER NOT NULL,
  updated_at      INTEGER
);

-- 同一模板下文件名唯一
-- 同一 asset_prefix 下文件名唯一
CREATE UNIQUE INDEX IF NOT EXISTS idx_template_assets_prefix_filename
  ON template_assets(asset_prefix, filename);

-- R2 key 全局唯一
CREATE UNIQUE INDEX IF NOT EXISTS idx_template_assets_r2_key 
  ON template_assets(r2_key);

CREATE INDEX IF NOT EXISTS idx_template_assets_prefix
  ON template_assets(asset_prefix);

CREATE INDEX IF NOT EXISTS idx_template_assets_checksum
  ON template_assets(checksum);

CREATE INDEX IF NOT EXISTS idx_template_assets_storage_type
  ON template_assets(storage_type);

CREATE INDEX IF NOT EXISTS idx_template_assets_public
  ON template_assets(is_public);

INSERT INTO "redirect_templates" VALUES(1,'error',0,replace('<!doctype html>\n<html lang="en" data-theme="light">\n  <head>\n    <meta charset="utf-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1" />\n    <title>Error Page</title>\n\n    <!-- daisyUI -->\n    <link\n      rel="stylesheet"\n      href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/5.1.25/daisyui.css"\n    />\n\n    <!-- Tailwind (browser build) -->\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"></script>\n  </head>\n\n  <body class="min-h-screen flex items-center justify-center bg-base-200 p-6">\n    <div class="card w-full max-w-md bg-base-100 shadow-xl">\n      <div class="card-body">\n        <h2 class="card-title">Info</h2>\n\n        <div class="divider my-2"></div>\n\n        <div class="space-y-1">\n          <div class="text-sm opacity-70">reason</div>\n          <div id="errorReason" class="font-semibold"></div>\n        </div>\n\n        <div class="mt-4 space-y-1">\n          <div class="text-sm opacity-70">info</div>\n          <div id="errorMessage" class="whitespace-pre-wrap"></div>\n        </div>\n      </div>\n    </div>\n\n    <script>\n      const ErrorCode = Object.freeze({\n        DATA_INPUT_ERROR: -1,\n        UNAUTHORIZED: -2,\n        SHORTURL_NOT_FOUND: -3,\n        LINK_EXPIRED: -4,\n        LINK_LIMIT_REACHED: -5,\n        UNKNOWN_ERROR: -999,\n        SUCCESS: 0,\n      });\n\n         const errorCode = {{error_code}};\n      const errorMessage = "{{error_message}}";\n\n      const errorReasonMap = {\n        [ErrorCode.DATA_INPUT_ERROR]: "data input error",\n        [ErrorCode.UNAUTHORIZED]: "unauthorized",\n        [ErrorCode.SHORTURL_NOT_FOUND]: "code not found",\n        [ErrorCode.LINK_EXPIRED]: "link expried",\n        [ErrorCode.LINK_LIMIT_REACHED]: "visit limit readched",\n        [ErrorCode.UNKNOWN_ERROR]: "unknown error",\n        [ErrorCode.SUCCESS]: "success",\n      };\n\n      function render() {\n        const reason =\n          errorReasonMap[errorCode] ?? `undefined error code：${errorCode}`;\n\n        const reasonEl = document.getElementById("errorReason");\n        const msgEl = document.getElementById("errorMessage");\n\n        reasonEl.textContent = reason;\n        msgEl.textContent = errorMessage || "";\n\n        if (errorCode === ErrorCode.SUCCESS) {\n          reasonEl.classList.remove("text-error");\n          reasonEl.classList.add("text-success");\n        } else {\n          reasonEl.classList.remove("text-success");\n          reasonEl.classList.add("text-error");\n        }\n      }\n\n      render();\n    </script>\n  </body>\n</html>\n','\n',char(10)),NULL,NULL,1,2,1,1770111484,1770713738);
INSERT INTO "redirect_templates" VALUES(2,'password',0,replace('<!doctype html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n\n  <!-- daisyUI（CDN CSS） -->\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/5.1.25/daisyui.css" />\n\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"></script>\n\n  <title>输入密码</title>\n</head>\n\n<body class="min-h-screen bg-base-200 flex items-center justify-center p-4">\n  <main class="w-full max-w-md">\n    <div class="card bg-base-100 shadow-xl">\n      <div class="card-body">\n        <h1 class="card-title justify-center">Please input password</h1>\n\n        <label class="form-control w-full mt-2">\n          <div class="label">\n            <span class="label-text">password</span>\n          </div>\n\n          <input\n            id="pwd"\n            type="password"\n            placeholder="password"\n            class="input input-bordered w-full"\n            autocomplete="current-password"\n          />\n\n          <div class="label">\n            <span id="emptyHint" class="label-text-alt text-error hidden">please input password</span>\n           <span id="pwdErr" class="label-text-alt text-error hidden">wrong password</span>\n          </div>\n        </label>\n\n        <div class="card-actions justify-end mt-2">\n          <button id="btn" class="btn btn-primary w-full">Check</button>\n        </div>\n      </div>\n    </div>\n  </main>\n\n  <script>\n    let errorpassword = {{errorpassword}}; \n    // ===================================================\n\n    const input = document.getElementById(''pwd'');\n    const btn = document.getElementById(''btn'');\n    const emptyHint = document.getElementById(''emptyHint'');\n    const pwdErr = document.getElementById(''pwdErr'');\n\n    function renderErrorPassword() {\n      pwdErr.classList.toggle(''hidden'', !errorpassword);\n    }\n\n    function go() {\n      const pwd = input.value.trim();\n\n      if (!pwd) {\n        emptyHint.classList.remove(''hidden'');\n        input.focus();\n        return;\n      }\n      emptyHint.classList.add(''hidden'');\n\n      const url = new URL(window.location.href);\n      url.searchParams.set(''password'', pwd);\n      window.location.href = url.toString();\n    }\n\n    btn.addEventListener(''click'', go);\n    input.addEventListener(''keydown'', (e) => {\n      if (e.key === ''Enter'') go();\n    });\n\n       renderErrorPassword();\n\n      // errorpassword = true; renderErrorPassword();\n  </script>\n</body>\n</html>\n','\n',char(10)),NULL,NULL,1,1,1,1770111484,1770713748);
INSERT INTO "redirect_templates" VALUES(3,'middle',0,replace('<!doctype html>\n<html lang="en" data-theme="light">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n\n    <!-- daisyUI CSS -->\n    <link\n      rel="stylesheet"\n      href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/5.1.25/daisyui.css"\n    />\n\n    <!-- TailwindCSS (browser build) -->\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"></script>\n\n    <title>Redirecting...</title>\n  </head>\n\n  <body class="min-h-screen bg-base-200">\n    <main class="min-h-screen flex items-center justify-center p-6">\n      <div class="card w-full max-w-md bg-base-100 shadow-xl">\n        <div class="card-body items-center text-center">\n          <h1 class="card-title">Redirecting...</h1>\n\n          <p class="text-base-content/80">\n            Redirect in <span id="secondsText" class="font-semibold">-</span> second\n          </p>\n\n          <div class="mt-2">\n            <span class="badge badge-primary badge-lg">\n              <span id="secondsBadge">-</span>s\n            </span>\n          </div>\n\n          <div class="divider my-4"></div>\n\n          <p class="text-sm text-base-content/70 break-all">\n          </p>\n\n          <div class="card-actions mt-2 w-full">\n            <button id="jumpBtn" class="btn btn-primary w-full">Jump right now</button>\n          </div>\n        </div>\n      </div>\n    </main>\n\n    <script>\n      // ====== 你可以修改这里 ======\n      const COUNTDOWN_SECONDS = {{delay}}; // X second\n      const tValue = "{{timestamp}}";\n      const sValue = "{{sign}}";\n      // =========================\n\n      const secondsText = document.getElementById("secondsText");\n      const secondsBadge = document.getElementById("secondsBadge");\n      const jumpBtn = document.getElementById("jumpBtn");\n\n      let left = COUNTDOWN_SECONDS;\n\n      function render() {\n        secondsText.textContent = String(left);\n        secondsBadge.textContent = String(left);\n      }\n\n      function buildTargetUrl() {\n  const url = new URL(window.location.href);\n\n        url.searchParams.set("t", tValue);\n        url.searchParams.set("s", sValue);\n\n        return url.toString();\n      }\n\n      function submitAndJump() {\n           window.location.assign(buildTargetUrl());\n      }\n\n      jumpBtn.addEventListener("click", submitAndJump);\n\n      render();\n      const timer = setInterval(() => {\n        left -= 1;\n        if (left <= 0) {\n          clearInterval(timer);\n          render();\n          submitAndJump();\n          return;\n        }\n        render();\n      }, 1000);\n    </script>\n  </body>\n</html>\n','\n',char(10)),NULL,NULL,1,0,1,1770111484,1770630311);




INSERT INTO "redirect_templates" VALUES(4,'error-cn',0,replace('<!doctype html>\n<html lang="zh-CN" data-theme="light">\n  <head>\n    <meta charset="utf-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1" />\n    <title>Error Page</title>\n\n    <!-- daisyUI -->\n    <link\n      rel="stylesheet"\n      href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/5.1.25/daisyui.css"\n    />\n\n    <!-- Tailwind (browser build) -->\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"></script>\n  </head>\n\n  <body class="min-h-screen flex items-center justify-center bg-base-200 p-6">\n    <div class="card w-full max-w-md bg-base-100 shadow-xl">\n      <div class="card-body">\n        <h2 class="card-title">系统提示</h2>\n\n        <div class="divider my-2"></div>\n\n        <div class="space-y-1">\n          <div class="text-sm opacity-70">错误原因</div>\n          <div id="errorReason" class="font-semibold"></div>\n        </div>\n\n        <div class="mt-4 space-y-1">\n          <div class="text-sm opacity-70">错误信息</div>\n          <div id="errorMessage" class="whitespace-pre-wrap"></div>\n        </div>\n      </div>\n    </div>\n\n    <script>\n      const ErrorCode = Object.freeze({\n        DATA_INPUT_ERROR: -1,\n        UNAUTHORIZED: -2,\n        SHORTURL_NOT_FOUND: -3,\n        LINK_EXPIRED: -4,\n        LINK_LIMIT_REACHED: -5,\n        UNKNOWN_ERROR: -999,\n        SUCCESS: 0,\n      });\n\n      // 示例：实际使用时替换为你的真实返回值\n      const errorCode = {{error_code}};\n      const errorMessage = "{{error_message}}";\n\n      const errorReasonMap = {\n        [ErrorCode.DATA_INPUT_ERROR]: "数据输入错误",\n        [ErrorCode.UNAUTHORIZED]: "未授权",\n        [ErrorCode.SHORTURL_NOT_FOUND]: "短链接不存在",\n        [ErrorCode.LINK_EXPIRED]: "链接已过期",\n        [ErrorCode.LINK_LIMIT_REACHED]: "访问次数已达上限",\n        [ErrorCode.UNKNOWN_ERROR]: "未知错误",\n        [ErrorCode.SUCCESS]: "成功",\n      };\n\n      function render() {\n        const reason =\n          errorReasonMap[errorCode] ?? `未定义错误码：${errorCode}`;\n\n        const reasonEl = document.getElementById("errorReason");\n        const msgEl = document.getElementById("errorMessage");\n\n        reasonEl.textContent = reason;\n        msgEl.textContent = errorMessage || "";\n\n        if (errorCode === ErrorCode.SUCCESS) {\n          reasonEl.classList.remove("text-error");\n          reasonEl.classList.add("text-success");\n        } else {\n          reasonEl.classList.remove("text-success");\n          reasonEl.classList.add("text-error");\n        }\n      }\n\n      render();\n    </script>\n  </body>\n</html>\n','\n',char(10)),NULL,NULL,1,2,1,1770111484,1770713738);
INSERT INTO "redirect_templates" VALUES(5,'password-cn',0,replace('<!doctype html>\n<html lang="zh-CN">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n\n  <!-- daisyUI（CDN CSS） -->\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/5.1.25/daisyui.css" />\n\n  <!-- Tailwind（Browser 版：按你的要求使用该 JS） -->\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"></script>\n\n  <title>输入密码</title>\n</head>\n\n<body class="min-h-screen bg-base-200 flex items-center justify-center p-4">\n  <main class="w-full max-w-md">\n    <div class="card bg-base-100 shadow-xl">\n      <div class="card-body">\n        <h1 class="card-title justify-center">请输入密码</h1>\n\n        <label class="form-control w-full mt-2">\n          <div class="label">\n            <span class="label-text">密码</span>\n          </div>\n\n          <input\n            id="pwd"\n            type="password"\n            placeholder="输入密码"\n            class="input input-bordered w-full"\n            autocomplete="current-password"\n          />\n\n          <div class="label">\n            <!-- 为空提示（可选） -->\n            <span id="emptyHint" class="label-text-alt text-error hidden">请输入密码</span>\n            <!-- 密码错误提示（按 errorpassword 控制） -->\n            <span id="pwdErr" class="label-text-alt text-error hidden">密码错误</span>\n          </div>\n        </label>\n\n        <div class="card-actions justify-end mt-2">\n          <button id="btn" class="btn btn-primary w-full">确定</button>\n        </div>\n      </div>\n    </div>\n  </main>\n\n  <script>\n    // ===== 你要的变量：改成 true 就会显示“密码错误” =====\n    let errorpassword = {{errorpassword}}; // true: 显示；false: 不显示\n    // ===================================================\n\n    const input = document.getElementById(''pwd'');\n    const btn = document.getElementById(''btn'');\n    const emptyHint = document.getElementById(''emptyHint'');\n    const pwdErr = document.getElementById(''pwdErr'');\n\n    function renderErrorPassword() {\n      pwdErr.classList.toggle(''hidden'', !errorpassword);\n    }\n\n    function go() {\n      const pwd = input.value.trim();\n\n      if (!pwd) {\n        emptyHint.classList.remove(''hidden'');\n        input.focus();\n        return;\n      }\n      emptyHint.classList.add(''hidden'');\n\n      // 跳转到当前页面，并追加/更新 password 参数\n      const url = new URL(window.location.href);\n      url.searchParams.set(''password'', pwd);\n      window.location.href = url.toString();\n    }\n\n    btn.addEventListener(''click'', go);\n    input.addEventListener(''keydown'', (e) => {\n      if (e.key === ''Enter'') go();\n    });\n\n    // 初次渲染（根据 errorpassword 决定是否显示红色“密码错误”）\n    renderErrorPassword();\n\n    // 如果你想在某些情况下动态修改并立即生效：\n    // errorpassword = true; renderErrorPassword();\n  </script>\n</body>\n</html>\n','\n',char(10)),NULL,NULL,1,1,1,1770111484,1770713748);
INSERT INTO "redirect_templates" VALUES(6,'middle-cn',0,replace('<!doctype html>\n<html lang="zh-CN" data-theme="light">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n\n    <!-- daisyUI CSS -->\n    <link\n      rel="stylesheet"\n      href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/5.1.25/daisyui.css"\n    />\n\n    <!-- TailwindCSS (browser build) -->\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.13/index.global.min.js"></script>\n\n    <title>倒计时跳转</title>\n  </head>\n\n  <body class="min-h-screen bg-base-200">\n    <main class="min-h-screen flex items-center justify-center p-6">\n      <div class="card w-full max-w-md bg-base-100 shadow-xl">\n        <div class="card-body items-center text-center">\n          <h1 class="card-title">即将跳转</h1>\n\n          <p class="text-base-content/80">\n            将在 <span id="secondsText" class="font-semibold">-</span> 秒后自动跳转（不丢参数）\n          </p>\n\n          <div class="mt-2">\n            <span class="badge badge-primary badge-lg">\n              <span id="secondsBadge">-</span>s\n            </span>\n          </div>\n\n          <div class="divider my-4"></div>\n\n          <p class="text-sm text-base-content/70 break-all">\n            目标：当前链接（保留现有参数，并附加/覆盖 t、s）\n          </p>\n\n          <div class="card-actions mt-2 w-full">\n            <button id="jumpBtn" class="btn btn-primary w-full">立即跳转</button>\n          </div>\n        </div>\n      </div>\n    </main>\n\n    <script>\n      // ====== 你可以修改这里 ======\n      const COUNTDOWN_SECONDS = {{delay}}; // X 秒\n      const tValue = "{{timestamp}}";\n      const sValue = "{{sign}}";\n      // =========================\n\n      const secondsText = document.getElementById("secondsText");\n      const secondsBadge = document.getElementById("secondsBadge");\n      const jumpBtn = document.getElementById("jumpBtn");\n\n      let left = COUNTDOWN_SECONDS;\n\n      function render() {\n        secondsText.textContent = String(left);\n        secondsBadge.textContent = String(left);\n      }\n\n      function buildTargetUrl() {\n        // 基于当前完整 URL，保留所有现有参数与 hash\n        const url = new URL(window.location.href);\n\n        // 覆盖/写入 t、s（不会丢其他参数，也不会重复）\n        url.searchParams.set("t", tValue);\n        url.searchParams.set("s", sValue);\n\n        return url.toString();\n      }\n\n      function submitAndJump() {\n        // “跳转请求”\n        window.location.assign(buildTargetUrl());\n      }\n\n      jumpBtn.addEventListener("click", submitAndJump);\n\n      render();\n      const timer = setInterval(() => {\n        left -= 1;\n        if (left <= 0) {\n          clearInterval(timer);\n          render();\n          submitAndJump();\n          return;\n        }\n        render();\n      }, 1000);\n    </script>\n  </body>\n</html>\n','\n',char(10)),NULL,NULL,1,0,1,1770111484,1770630311);

